var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/almond",function(){}),define("fiddler/util/url",[],function(){var e={parseQuery:function(e){var t={};return e[0]==="?"&&(e=e.slice(1)),e===""?t:(e.split("&").forEach(function(e){var n=e.indexOf("=");t[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1))}),t)}};return{URL:e}}),define("fiddler/client",["require","./util/url"],function(e){function n(e){var t=this;this.$xhr=e,this.$fr=null,this.$text=null,this.onload=null,this.onerror=null,this.onabort=null,e.onload=function(){t.$prepareText(!0)},e.onabort=function(){t.$aborted()},e.onerror=function(){t.$prepareText(!1)}}function i(e){e=e===undefined?null:e,this.$baseURL=e,this.$consumerKey=null,this.$consumerSecret=null,this.$tokenKey=null,this.$tokenSecret=null,this.$asUserId=null}var t=e("./util/url").URL;n.prototype={getStatus:function(){return this.$xhr.status},abort:function(){this.$fr===null?this.$xhr.abort():this.$fr.abort()},getText:function(){return this.$text},getJSON:function(){return JSON.parse(this.getText())},getBlob:function(){return this.$xhr.response},$prepareText:function(e){var t=this;this.$isTextContentType(this.$xhr.getResponseHeader("Content-Type"))?(this.$fr=new FileReader,this.$fr.onload=function(){t.$text=t.$fr.result,t.$completed(!0)},this.$fr.onerror=function(){t.$completed(!1)},this.$fr.onabort=function(){t.$aborted()},this.$fr.readAsText(this.$xhr.response)):this.$completed(e)},$isTextContentType:function(e){return e?e.indexOf("text/")===0?!0:e.indexOf("application/json")===0?!0:!1:!1},$completed:function(e){var t=e?this.onload:this.onerror;t!==null&&t(this)},$aborted:function(){this.onabort!==null&&this.onabort(this)}};var r={ANONYMOUS:"anonymous",CONSUMER:"consumer",TOKEN:"token",ALL:["anonymous","consumer","token"],compare:function(e,t){return r.ALL.indexOf(e)-r.ALL.indexOf(t)}};return i.MOTHER_BASE_URL="https://apps.usos.edu.pl/",i.$requestTokenOptions={},i.$requestTokenCounter=0,i.requestTokenAuthorized=function(e,n){var r=i.$requestTokenOptions[e];r.client.setToken({key:r.tokenKey,secret:r.tokenSecret}),r.client.callMethod({path:"services/oauth/access_token",params:{oauth_verifier:n},complete:function(e){var n;e.getStatus()!==200?r.error(e):(n=t.parseQuery(e.getText()),r.success({key:n.oauth_token,secret:n.oauth_token_secret}))}})},i.requestTokenDenied=function(e){var t=i.$requestTokenOptions[e];t.deny()},i.prototype={getBaseURL:function(){return this.$baseURL},setBaseURL:function(e){this.$baseURL=e},hasBaseURL:function(){return this.$baseURL!==null},setConsumer:function(e){e===null?this.clearConsumer():(this.$consumerKey=e.key,this.$consumerSecret=e.secret)},hasConsumer:function(){return this.$consumerKey!==null},clearConsumer:function(){this.$consumerKey=null,this.$consumerSecret=null},setToken:function(e){var t=null,n=null,r=null;e!==null&&(e.userId?r=e.userId:(t=e.key,n=e.secret)),this.$tokenKey=t,this.$tokenSecret=n,this.$asUserId=r},getToken:function(){return this.$tokenKey!==null?{key:this.$tokenKey,secret:this.$tokenSecret}:this.$asUserId!==null?{userId:this.$asUserId}:null},hasToken:function(){return this.$tokenKey!==null||this.$asUserId!==null},copy:function(){var e=new i;return e.$baseURL=this.$baseURL,e.$consumerKey=this.$consumerKey,e.$consumerSecret=this.$consumerSecret,e.$tokenKey=this.$tokenKey,e.$tokenSecret=this.$tokenSecret,e.$asUserId=this.$asUserId,e},$getAuthParams:function(e){var t={oauth_consumer_key:this.$consumerKey,oauth_signature_method:"PLAINTEXT",oauth_signature:this.$consumerSecret+"&",oauth_timestamp:Math.floor(Date.now()/1e3).toString(),oauth_nonce:this.$generateNonce(),oauth_version:"1.0"};return this.$tokenKey&&e&&(t.oauth_token=this.$tokenKey,t.oauth_signature+=this.$tokenSecret),t},$generateNonce:function(){return Math.floor(Math.random()*1e9).toString()},$getAuthHeader:function(e){var t="OAuth ";return $.each(this.$getAuthParams(e),function(e,n){t+=e+'="'+encodeURIComponent(n)+'", '}),t.slice(0,-2)},$prepareParams:function(e){var t,n=Object.keys(e).filter(function(t){return e[t]!==null});return n.length===0?null:n.every(function(t){return typeof e[t]=="string"})?$.param(n.map(function(t){return{name:t,value:e[t]}})):(t=new FormData,n.forEach(function(n){t.append(n,e[n])}),t)},callMethod:function(e){var t,i,s;e=$.extend({path:undefined,params:{},complete:function(){},error:function(){},success:function(){},abort:function(){},signMode:null},e);if(e.signMode===null)this.hasConsumer()?this.hasToken()?e.signMode=r.TOKEN:e.signMode=r.CONSUMER:e.signMode=r.ANONYMOUS;else{if(e.signMode!==r.ANONYMOUS&&!this.hasConsumer())throw new Error("Missing consumer");if(e.signMode===r.TOKEN&&!this.hasToken())throw new Error("Missing token")}return s=new XMLHttpRequest,t=new n(s),t.onload=function(){e.success(t),e.complete(t)},t.onabort=function(){e.abort(t)},t.onerror=function(){e.error(t),e.complete(t)},s.open("POST",this.$baseURL+e.path),e.signMode!==r.ANONYMOUS&&s.setRequestHeader("Authorization",this.$getAuthHeader(e.signMode===r.TOKEN)),s.responseType="blob",i=$.extend({},e.params),e.signMode===r.TOKEN&&this.$asUserId&&(i.as_user_id=this.$asUserId),i=this.$prepareParams(i),i===null?s.setRequestHeader("Content-Type","text/plain"):typeof i=="string"&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i===null?s.send():s.send(i),t},$getAuthorizedCallback:function(){var e=String(document.location);return e=e.slice(0,e.lastIndexOf("/")),e+="/authorized.html",e},acquireAccessToken:function(e){var n;e=$.extend({scopes:[],success:function(){},deny:function(){},error:function(){}},e),e.client=this.copy(),n=i.$requestTokenCounter++,e.client.callMethod({path:"services/oauth/request_token",params:{oauth_callback:this.$getAuthorizedCallback()+"?request_id="+n,scopes:e.scopes.join("|")},complete:function(r){var s;r.getStatus()!==200?e.error(r):(s=t.parseQuery(r.getText()),e.tokenKey=s.oauth_token,e.tokenSecret=s.oauth_token_secret,i.$requestTokenOptions[n]=e,window.open(e.client.getBaseURL()+"services/oauth/authorize?oauth_token="+s.oauth_token,null,"menubar=1,resizable=1,width=800,height=600"))},signMode:r.CONSUMER})}},window.FiddlerClient=i,{Client:i,SignMode:r}}),define("fiddler/util/dom",[],function(){function e(){return"uniqueid-"+e.$counter++}return e.$counter=1,{generateUniqueId:e}}),define("fiddler/resource",[],function(){function e(e){return e}return{getResourceURL:e}}),define("fiddler/-template",[],function(){function renderTemplate(e,t,n){return TEMPLATES[e].call(t,t||{},n)}var EJS={Scanner:{to_text:function(e){return e==null||e===undefined?"":e instanceof Date?e.toDateString():e.toString?e.toString():""}}},TEMPLATES={"method-tab":function(_CONTEXT,_VIEW){try{with(_VIEW)with(_CONTEXT){var ___ViewO=[];___ViewO.push('<div style="width: 100%; height: 100%">\n'),___ViewO.push('    <div class="ui-layout-north fiddler-toolbar">\n'),___ViewO.push('        <input type="button" value="Pin" class="fiddler-pin-button"/>\n'),___ViewO.push('        <span class="fiddler-label">Sign mode:</span>\n'),___ViewO.push("        \n"),___ViewO.push('        <form class="fiddler-inline fiddler-sign-mode-form">\n'),___ViewO.push("            ");var id=generateUniqueId();___ViewO.push("\n"),___ViewO.push('            <input type="radio" name="signMode" checked="checked" value="anonymous" id="'),___ViewO.push(EJS.Scanner.to_text(id)),___ViewO.push('"/>\n'),___ViewO.push('            <label for="'),___ViewO.push(EJS.Scanner.to_text(id)),___ViewO.push('">anomymous</label>\n'),___ViewO.push("            \n"),___ViewO.push("            ");var id=generateUniqueId();___ViewO.push("\n"),___ViewO.push('            <input type="radio" name="signMode" value="consumer" id="'),___ViewO.push(EJS.Scanner.to_text(id)),___ViewO.push('"/>\n'),___ViewO.push('            <label for="'),___ViewO.push(EJS.Scanner.to_text(id)),___ViewO.push('">consumer</label>\n'),___ViewO.push("            \n"),___ViewO.push("            ");var id=generateUniqueId();return ___ViewO.push("\n"),___ViewO.push('            <input type="radio" name="signMode" value="token" id="'),___ViewO.push(EJS.Scanner.to_text(id)),___ViewO.push('"/>\n'),___ViewO.push('            <label for="'),___ViewO.push(EJS.Scanner.to_text(id)),___ViewO.push('">token</label>\n'),___ViewO.push("        </form>\n"),___ViewO.push("         \n"),___ViewO.push('        <input type="button" value="Execute" class="fiddler-execute-button"/>\n'),___ViewO.push('        <img src="'),___ViewO.push(EJS.Scanner.to_text(resourceURL("img/throbber.gif"))),___ViewO.push('" class="fiddler-throbber" style="display: none"/>\n'),___ViewO.push("    </div>\n"),___ViewO.push('    <div class="ui-layout-center">\n'),___ViewO.push('        <h2 class="fiddler-method-name"/>\n'),___ViewO.push('        <p class="fiddler-method-desc"/>\n'),___ViewO.push('        <form class="fiddler-method-form">\n'),___ViewO.push('            <dl class="fiddler-method-params"/>\n'),___ViewO.push('            <p style="display: none"><input type="submit"/></p>\n'),___ViewO.push("        </form>\n"),___ViewO.push("    </div>\n"),___ViewO.push('    <div class="ui-layout-south">\n'),___ViewO.push('        <div style="width: 100%; height: 100%" class="fiddler-content">\n'),___ViewO.push('            <pre class="fiddler-response-editor"></pre>\n'),___ViewO.push('            <iframe src="about:blank" class="fiddler-response-frame" style="display: none"></iframe>\n'),___ViewO.push("        </div>\n"),___ViewO.push("    </div>\n"),___ViewO.push("</div>\n"),___ViewO.join("")}}catch(e){throw e.lineNumber=null,e}},"scope-dialog":function(_CONTEXT,_VIEW){try{with(_VIEW)with(_CONTEXT){var ___ViewO=[];return ___ViewO.push('<form title="Choose scopes">\n'),___ViewO.push("    <ul>\n"),___ViewO.push("        "),scopes.forEach(function(e){var t=generateUniqueId();___ViewO.push("\n"),___ViewO.push("        <li>\n"),___ViewO.push('            <input id="'),___ViewO.push(EJS.Scanner.to_text(t)),___ViewO.push('" type="checkbox" name="scopes[]" value="'),___ViewO.push(EJS.Scanner.to_text(e.key)),___ViewO.push('"/><label for="'),___ViewO.push(EJS.Scanner.to_text(t)),___ViewO.push('">\n'),___ViewO.push("            <b>"),___ViewO.push(EJS.Scanner.to_text(e.key)),___ViewO.push("</b>\n"),___ViewO.push("            "),___ViewO.push(EJS.Scanner.to_text(e.developers_description)),___ViewO.push("\n"),___ViewO.push("            </label>\n"),___ViewO.push("        </li>\n"),___ViewO.push("        ")}),___ViewO.push("\n"),___ViewO.push("    </ul>\n"),___ViewO.push("</form>\n"),___ViewO.join("")}}catch(e){throw e.lineNumber=null,e}}};return{renderTemplate:renderTemplate}}),define("fiddler/template",["require","./util/dom","./resource","./-template"],function(e){function s(e,t){return r(e,t,i)}var t=e("./util/dom").generateUniqueId,n=e("./resource").getResourceURL,r=e("./-template").renderTemplate,i={generateUniqueId:t,resourceURL:n};return{renderTemplate:s}}),define("fiddler/apiref/cache",["require","../client"],function(e){function r(){this.$methodInfos=null,this.$baseURL=null}var t=e("../client").SignMode,n=null;return r.getInstance=function(){return n||(n=new r),n},r.fetchMethodInfo=function(e,t,n,i){r.getInstance().fetchMethodInfo(e,t,n,i)},r.prototype={fetchMethodInfo:function(e,n,r,i){var s=e.getBaseURL();if(this.$baseURL!==s)this.$baseURL=s,this.$methodInfos={};else if(n in this.$methodInfos){r(this.$methodInfos[n]);return}e.callMethod({path:"services/apiref/method",params:{name:n},signMode:t.ANONYMOUS,complete:function(e){var t;e.getStatus()===200?(t=e.getJSON(),this.$baseURL===s&&(this.$methodInfos[n]=t),r(t)):i(e)}})}},{ApirefCache:r}}),define("fiddler/apiref/field-extractor",["require","./cache"],function(e){function n(e,n,r){t.fetchMethodInfo(e,n,function(e){r(i(e.returns))},function(){r({})})}function i(e){var t,n;t=document.createElement("div"),t.innerHTML=e;for(n=t.firstChild;n;n=n.nextSibling)if(n.nodeName.toLowerCase()==="p"&&r.test(n.textContent)){for(n=n.nextSibling;n&&n.nodeName==="#text";)n=n.nextSibling;return n&&n.nodeName.toLowerCase()==="ul"?u(n):{}}return{}}function s(e,t,n){var r;for(r=e.firstChild;r;r=r.nextSibling)if(r.nodeName.toLowerCase()===t)return r;return n===undefined?null:n}function o(e,t,n){var r=s(e,t);return r?r.textContent:n===undefined?null:n}function u(e){var t,n,r=!1,i,s,u={};for(t=e.firstChild;t;t=t.nextSibling){if(t.nodeName.toLowerCase()!=="li")continue;s=o(t,"p","").trim();if(s==="Primary:")i="primary";else{if(s!=="Secondary:"){if(r)continue;return a(t,"primary",u),u}i="secondary"}r=!0;for(n=t.firstChild;n;n=n.nextSibling)if(n.nodeName.toLowerCase()==="ul"){a(n.firstChild,i,u);break}}return u}function a(e,t,n){var r,i,s;for(;e;e=e.nextSibling)e.nodeName.toLowerCase()==="li"&&(r=e.getElementsByTagName("b")[0],r&&(i=r.textContent.trim(),/^[a-zA-Z0-9_]+$/.test(i)&&(s={name:i,group:t},c(e,s),n[i]=s)))}function l(e){var t=e.match(/developers\/api\/(services\/[a-z0-9_\/]+\/)#([a-z0-9_]+)$/);return t?t[1]+t[2]:null}function c(e,t){var n,r,i,s,o;e:for(n=e.firstChild;n;n=n.nextSibling)if(n.nodeName.toLowerCase()==="p"&&f.test(n.textContent)){r=n.getElementsByTagName("a"),i=null;for(o=0;o<r.length;o++){s=l(r[o].href);if(s){if(i)continue e;i=s}}i&&(t.refs=i,/only\s+primary\s+are\s+allowed/.test(n.textContent)&&(t.refsPrimaryOnly=!0))}}function h(e,t,r,i,s){n(e,t,function(t){var n,o;r.length===0?(o=Object.getOwnPropertyNames(t),s&&(o=o.filter(function(e){return t[e].group==="primary"})),i(o)):(n=t[r[0]],n&&n.refs?h(e,n.refs,r.slice(1),i,n.refsPrimaryOnly):i({}))})}function p(e,t){var n,r,i,s,o,u;n=document.createElement("div"),n.innerHTML=e,r=n.getElementsByTagName("a"),o=null;for(i=0;i<r.length;i++){s=l(r[i].href);if(s){if(o)return null;o=s}}return o?(u=/primary fields/.test(n.textContent),{refs:o,refsPrimaryOnly:u}):{refs:t}}function d(e,n,r,i,s){t.fetchMethodInfo(e,n,function(t){var o,u;for(o=0;o<t.arguments.length;o++)if(t.arguments[o].name===r){u=p(t.arguments[o].description,n),u?h(e,u.refs,i,s,u.refsPrimaryOnly):s([]);return}s([])},function(){s([])})}var t=e("./cache").ApirefCache,r=/\bfields\b[\s\w\d]*:\s*$/mi,f=/(^\s*(This field references|Each element of this list is a))|\bsubfield selector\b/;return{fetchParamFieldNames:d}}),define("fiddler/input-widget",["require","./apiref/field-extractor"],function(e){function n(e){var t=e.split(/([\[\]\|])/g),n=[t[0]],r;for(r=1;r<t.length;r+=2)t[r]==="["?n.push(""):t[r]==="]"&&n.length>1&&n.pop(),n[n.length-1]=t[r+1];return n}function r(e,r,i,s){this.$name=e,this.$node=$("<input/>").attr("name",e).autocomplete({minLength:0,source:function(r,o){var u=n(r.term);t(i,s,e,u.slice(0,-1),function(e){o($.ui.autocomplete.filter(e,u[u.length-1]))})},focus:function(){return!1},select:function(e,t){var n=this.value,r=n.match(/[^\[\]\|]*$/);return n=n.slice(0,n.length-r[0].length),n.slice(-1)==="]"&&(n+="|"),this.value=n+t.item.value,!1}}).focus(function(){$(this).autocomplete("search",this.value)}),r&&this.$node.attr("placeholder",r),this.$methodPath=s}function i(){}function o(e,t){this.$name=e,this.$node=$("<input/>").attr("name",e),t&&this.$node.attr("placeholder",t)}function u(e,t){o.call(this,e,t)}function a(e){this.$name=e,this.$node=$("<textarea cols='50' rows='10'></textarea>")}function f(e){this.$name=e,this.$node=$("<input type='file'/>")}function l(e,t,n){var r;this.$name=e,this.$node=r=$("<select/>").attr("name",e),$.each(t,function(e,t){r.append($("<option/>").attr("selected",t===n).attr("value",t).text(t))})}var t=e("./apiref/field-extractor").fetchParamFieldNames;r.createFromParamInfo=function(e,t,n){return new r(e.name,e.default_value,n,t)},r.prototype={getValue:function(){return this.$node.val()||null},getNode:function(){return this.$node},getName:function(){return this.$name}};var s={"services/mailing/send_simple_message#content":a,"services/mailing/send_simple_by_template#content_template":a,"services/mailing/send_simple_messages#param_sets":a,"services/blobbox/put_unsigned#data":f,"services/minefield/file_echo#data":f,"services/prgroups/primary_group#primary_group_id":u,"services/prgroups/primary_groups#primary_group_ids":u,"services/prgroups/create_descriptor#source":a,"services/prgroups/update_descriptor#source":a,"services/mailclient/put_attachment#data":f};return i.createFromParamInfo=function(e,t,n){var i;return e.name==="fields"?i=r:i=s[t+"#"+e.name]||o,i.createFromParamInfo(e,t,n)},o.createFromParamInfo=function(e){return new o(e.name,e.default_value)},o.prototype={getValue:function(){return this.$node.val()||null},getNode:function(){return this.$node},getName:function(){return this.$name}},u.createFromParamInfo=function(e){return new u(e.name,e.default_value)},u.prototype=$.extend(Object.create(o.prototype),{getValue:function(){return this.$node.val()}}),a.createFromParamInfo=function(e){return new a(e.name)},a.prototype={getValue:function(){return this.$node.val()||null},getNode:function(){return this.$node},getName:function(){return this.$name}},f.createFromParamInfo=function(e){return new f(e.name)},f.prototype={getValue:function(){return this.$node[0].files[0]||null},getNode:function(){return this.$node},getName:function(){return this.$name}},l.prototype={getValue:function(){return this.$node.val()||null},getNode:function(){return this.$node},getName:function(){return this.$name}},{InputWidget:i,StringInput:o,TextareaInput:a,FileInput:f,ChoiceInput:l}}),define("fiddler/dialog",[],function(){var e={showError:function(e){var t;e=$.extend({title:"Error occured",width:300,height:"auto",text:null,content:null},e),t=$("<div></div>"),e.text?t.text(e.text):t.html(e.content),t.dialog({title:e.title,width:e.width,height:e.height,modal:!0,buttons:{OK:function(){t.dialog("close")}},close:function(){t.remove()}})},showGenericClientError:function(){e.showError({text:"An error occurred while connecting to the specified USOSapi installation."})}};return{Dialog:e}}),define("fiddler/util/pretty",[],function(){function e(e){var t="",n=/(>)(<)(\/*)/g;e=e.replace(n,"$1\r\n$2$3");var r=0;return jQuery.each(e.split("\r\n"),function(e,n){var i=0;n.match(/.+<\/\w[^>]*>$/)?i=0:n.match(/^<\/\w/)?r!==0&&(r-=1):n.match(/^<\w[^>]*[^\/]>.*$/)?i=1:i=0;var s="";for(var o=0;o<r;o++)s+="    ";t+=s+n+"\r\n",r+=i}),t}function t(e){return JSON.stringify(JSON.parse(e),null,4)}return{prettifyXML:e,prettifyJSON:t}}),define("fiddler/method-tab",["require","./client","./template","./input-widget","./dialog","./util/pretty"],function(e){function a(e){var r=this;this.$tabs=null,this.$node=$(n("method-tab")),this.$titleNode=this.$node.find(".fiddler-method-name"),this.$descNode=this.$node.find(".fiddler-method-desc"),this.$paramsNode=this.$node.find(".fiddler-method-params"),this.$signModeForm=this.$node.find(".fiddler-sign-mode-form"),this.$formatWidget=null,this.$node.find(".fiddler-execute-button").click(this.$executeMethod.bind(this)),this.$node.find(".fiddler-method-form").submit(function(e){e.preventDefault(),r.$executeMethod()}),this.$node.find(".fiddler-pin-button").click(function(){r.$pinned=!r.$pinned,this.value=r.$pinned?"Unpin":"Pin"}),this.$throbberContainer=this.$node.find(".fiddler-throbber"),this.$responseEditorNode=this.$node.find(".fiddler-response-editor"),this.$responseFrameNode=r.$node.find(".fiddler-response-frame"),this.$layout=this.$node.layout({maskIframesOnResize:!0,fxName:"none",north:{resizable:!1,closable:!1,spacing_open:0},south:{contentSelector:".fiddler-content",onresize_end:function(){r.$responseEditor.resize()},size:300,initClosed:!0}}),this.$signModeForm.tooltip().buttonset(),this.$client=e,this.$paramWidgets=[],this.$pendingResponse=null,this.$responseEditor=ace.edit(this.$responseEditorNode[0]),this.$responseEditor.getSession().setMode("ace/mode/text"),this.$responseEditor.getSession().setUseWrapMode(!0),this.$responseEditor.getSession().setWrapLimitRange(null,null),this.$responseEditor.setReadOnly(!0),this.$responseEditor.renderer.setShowPrintMargin(!1),this.$responseRenderer="editor",this.$methodInfo=null,this.$lastSignMode1=t.ANONYMOUS,this.$lastSignMode2=t.ANONYMOUS,this.$pinned=!1}var t=e("./client").SignMode,n=e("./template").renderTemplate,r=e("./input-widget").InputWidget,i=e("./input-widget").ChoiceInput,s=e("./dialog").Dialog,o=e("./util/pretty").prettifyJSON,u=e("./util/pretty").prettifyXML;return a.prototype={setTabs:function(e){this.$tabs=e},getNode:function(){return this.$node},isPinned:function(){return this.$pinned},resize:function(){this.$node.layout().resizeAll(),this.$responseRenderer==="editor"&&this.$responseEditor.resize()},getClient:function(){return this.$client},setClient:function(e){this.$client=e},getSignMode:function(){return this.$signModeForm.find("input:checked").val()},$setSignModeBounds:function(e,n){var r=this.$signModeForm.find("input:checked").val();r!==this.$lastSignMode2?this.$lastSignMode1=r:r=this.$lastSignMode1,t.compare(r,e)<0?r=e:t.compare(r,n)>0&&(r=n),this.$lastSignMode2=r,this.$signModeForm.find("input[value="+r+"]").prop("checked",!0),t.ALL.forEach(function(r){this.$signModeForm.find("input[value="+r+"]").prop("disabled",t.compare(r,e)<0||t.compare(r,n)>0)},this),this.$signModeForm.buttonset("refresh")},getParamValues:function(){var e={};return $.each(this.$paramWidgets,function(t,n){var r=n.getValue();r!==null&&(e[n.getName()]=r)}),e},$setResponseRenderer:function(e){if(this.$responseRenderer===e)return;switch(this.$responseRenderer){case"editor":this.$responseEditorNode.hide();break;case"frame":this.$responseFrameNode.hide()}switch(e){case"editor":this.$responseEditorNode.show(),this.$responseEditor.resize();break;case"frame":this.$responseFrameNode.show()}this.$responseRenderer=e},setResponseEditorValue:function(e,t){this.$setResponseRenderer("editor"),this.$responseEditor.setValue(e),this.$responseEditor.clearSelection(),this.$responseEditor.moveCursorTo(0,0),this.$responseEditor.getSession().setMode({json:"ace/mode/json",text:"ace/mode/text",xml:"ace/mode/xml"}[t])},setResponseFrameValue:function(e){var t;this.$setResponseRenderer("frame"),e instanceof Blob?this.$responseFrameNode.get(0).src=URL.createObjectURL(e):(t=this.$responseFrameNode.get(0).contentWindow.document,t.open(),t.write(e),t.close())},prettifyValue:function(e,t){return t==="json"?o(e):t==="xml"?u(e):e},getLabel:function(){return this.$methodInfo===null?"":this.$methodInfo.name.slice(9)},setMethodInfo:function(e){var n=this.$paramsNode,s=[],o=!1,u,a=this;this.$titleNode.text(e.name),this.$descNode.text(e.brief_description+" ").append($("<a target='_blank'>more</a>").prop("href",e.ref_url)),n.empty(),$.each(e.arguments,function(t,i){var u;if(i.name==="format"){o=!0;return}if(i.name==="callback")return;u=r.createFromParamInfo(i,e.name,a.$client),n.append($("<dt/>").text(i.name).css(i.is_required?{fontWeight:"bold"}:{}).tooltip({items:"dt",content:i.description,show:!1,hide:!1})).append($("<dd/>").append(u.getNode())),s.push(u)}),o&&(u=this.$formatWidget,u||(u=new i("format",["json","xmlmap2","xmlmap","xmlitems"],"json"),this.$formatWidget=u),n.append($("<dt>format</dt>")),n.append($("<dd/>").append(u.getNode())),s.push(u)),this.setResponseEditorValue("","text"),this.$paramWidgets=s,this.$methodInfo=e,e.auth_options.consumer==="ignored"?this.$setSignModeBounds(t.ANONYMOUS,t.ANONYMOUS):e.auth_options.consumer==="optional"?e.auth_options.token==="ignored"?this.$setSignModeBounds(t.ANONYMOUS,t.CONSUMER):this.$setSignModeBounds(t.ANONYMOUS,t.TOKEN):e.auth_options.token==="ignored"?this.$setSignModeBounds(t.CONSUMER,t.CONSUMER):e.auth_options.token==="optional"?this.$setSignModeBounds(t.CONSUMER,t.TOKEN):this.$setSignModeBounds(t.TOKEN,t.TOKEN),this.$tabs.updateTabLabel(this),this.resize()},activate:function(){this.$tabs.setActiveTab(this)},$executeMethod:function(){var e=this,n=e.getParamValues(),r=e.getSignMode();if(r!==t.ANONYMOUS&&!e.getClient().hasConsumer()){s.showError({text:"You must specify consumer first!"});return}if(r===t.TOKEN&&!e.getClient().hasToken()){s.showError({text:"You must specify token first!"});return}e.$pendingResponse&&e.$pendingResponse.abort(),e.$throbberContainer.show(),e.$pendingResponse=e.getClient().callMethod({path:e.$methodInfo.name,params:n,signMode:r,complete:function(t){var r,i;if(t.getStatus()===500)r=t.getText(),/^\s*</.test(r)?e.setResponseFrameValue(r):e.setResponseEditorValue(r,"text");else if(t.getStatus()!==200)try{t.getJSON(),e.setResponseEditorValue(e.prettifyValue(t.getText(),"json"),"json")}catch(s){e.setResponseEditorValue(t.getText(),"text")}else r=t.getText(),r===null?e.setResponseFrameValue(t.getBlob()):(i={xmlmap:"xml",xmlmap2:"xml",xmlitems:"xml",json:"json"}[n.format]||"text",e.setResponseEditorValue(e.prettifyValue(t.getText(),i),i));e.$pendingResponse=null,e.$throbberContainer.hide(),e.$layout.open("south")}})}},{SignMode:t,MethodTab:a}}),define("fiddler/tab",[],function(){function e(e,t,n){this.$active=null,this.$all=[],this.$tabbarNode=e,this.$tabsNode=t,this.$blankNode=n}return e.createFromNode=function(t){return new e(t.find(".fiddler-tabbar").first(),t.find(".fiddler-tabs").first(),t.find(".fiddler-tab-blank").first())},e.prototype={$indexOf:function(e){var t;for(t=0;t<this.$all.length;t++)if(this.$all[t].tab===e)return t;return-1},setActiveTab:function(e){e!==this.$active.tab&&(this.$active.tab.getNode().hide(),this.$active.li.removeClass("fiddler-active"),this.$active=this.$all[this.$indexOf(e)],e.getNode().show(),e.resize(),this.$active.li.addClass("fiddler-active"))},getActiveTab:function(){return this.$active===null?null:this.$active.tab},updateTabLabel:function(e){this.$all[this.$indexOf(e)].label.text(e.getLabel())},addTab:function(e){var t,n,r=this,i;return e.setTabs(this),this.$tabsNode.append(e.getNode()),this.$tabbarNode.append(i=$("<li></li>").append(t=$("<a class='fiddler-label' href='#'></a>").click(function(){r.setActiveTab(e)})).append($("<a class='fiddler-close ui-icon ui-icon-close' href='#'>x</a>").click(function(){r.removeTab(e)}))),n={tab:e,label:t,li:i},this.$active===null?(this.$active=n,this.$blankNode.hide(),i.addClass("fiddler-active")):$(e.getNode()).hide(),t.text(e.getLabel()),this.$all.push(n),e},removeTab:function(e){var t;e.getNode().remove(),t=this.$indexOf(e),this.$all[t].li.remove(),this.$all.splice(t,1),e===this.$active.tab&&(this.$all.length===0?(this.$active=null,this.$blankNode.show()):(t=Math.min(this.$all.length-1,t),this.$active=this.$all[t],this.$active.tab.getNode().show(),this.$active.tab.resize(),this.$active.li.addClass("fiddler-active")))},resize:function(){this.$active!==null&&this.$active.tab.resize()}},{Tabs:e}}),define("fiddler/config-storage",[],function(){function n(e){this.$keyPrefix=e}var e=null,t={get:function(t,n){return e.get(t,n)},set:function(t,n){e.set(t,n)},addMRU:function(e,t,n,r){var i,s;n=n===undefined?10:n,r=r===undefined?function(e,t){return e===t}:r,s=this.get(e,[]);for(i=0;i<s.length;i++)if(r(t,s[i])){s.splice(i,1);break}s.unshift(t),s.length>n&&s.splice(n,s.length-n),this.set(e,s)}};return n.prototype={get:function(e,t){var n=localStorage.getItem(this.$keyPrefix+e);try{return n===null?t:JSON.parse(n)}catch(r){return t}},set:function(e,t){localStorage.setItem(this.$keyPrefix+e,JSON.stringify(t))}},e=new n("fiddler."),{Storage:t}}),define("fiddler/client-bar",["require","./config-storage","./client","./template","./dialog"],function(e){function o(e,t){this.$client=t,this.$tokenPane=new u(this,e),this.$consumerPane=new h(this,e),this.$installationPane=new v(this,e)}function u(e,n){var r,i,s,o,u;r=n.find(".fiddler-pane.fiddler-token"),o=r.find(".fiddler-user-id"),i=r.find(".fiddler-key"),s=r.find(".fiddler-secret"),u=r.find(".fiddler-acquire"),this.$bar=e,this.$paneNode=r,this.$keyNode=i,this.$secretNode=s,this.$userIdNode=o,this.$mode="keySecret",i.val()||s.val()?(o.val(""),this.$keySecretChanged()):o.val()?(this.$setMode("userId"),this.$userIdChanged()):this.setToken(t.get("token",null)),i.change(this.$keySecretChanged.bind(this)),s.change(this.$keySecretChanged.bind(this)),o.change(this.$userIdChanged.bind(this)),r.find("a.fiddler-for-key-secret").click(this.$userIdChanged.bind(this)),r.find("a.fiddler-for-user-id").click(this.$keySecretChanged.bind(this)),u.click(this.acquireAccessToken.bind(this))}function a(e){return e==="keySecret"?".fiddler-for-key-secret":".fiddler-for-user-id"}function f(e){return!!e}function l(e){return!!e}function c(e){return/[1-9]\d*/.test(e)}function h(e,n){var r,i,s,o,u=this;r=n.find(".fiddler-pane.fiddler-consumer"),i=r.find(".fiddler-key"),s=r.find(".fiddler-secret"),o=r.find(".fiddler-clear"),this.$bar=e,this.$keyNode=i,this.$secretNode=s,i.val()||s.val()?this.$changed():this.setConsumer(t.get("consumer",null)),this.$keyNode.change(this.$changed.bind(this)),s.change(this.$changed.bind(this)),o.click(function(){u.setConsumer(null)})}function p(e){return!!e}function d(e){return!!e}function v(e,n){var i,s,o=this;i=n.find(".fiddler-pane.fiddler-installation"),s=i.find(".fiddler-base-url"),this.$bar=e,this.$paneNode=i,this.$baseURLNode=s,this.$installationNames={},this.$installationURLs=[],s.val()?this.$changed():this.setInstallation(t.get("installation",null)),s.change(this.$changed.bind(this)).installationAutocomplete({delay:0,minLength:0,source:this.$getAutocompleteSource(),change:this.$changed.bind(this)}).focus(function(){$(this).installationAutocomplete("search",this.value)}),(new r(r.MOTHER_BASE_URL)).callMethod({path:"services/apisrv/installations",success:function(e){e.getJSON().forEach(function(e){var t=e.base_url.replace(/^http:/,"https:");o.$installationNames[t]=e.institution_name.en||e.institution_name.pl,o.$installationURLs.push(t)}),o.$autocompleteSourceChanged()}})}function m(e){return!!e}var t=e("./config-storage").Storage,n=e("./client").SignMode,r=e("./client").Client,i=e("./template").renderTemplate,s=e("./dialog").Dialog;return o.createFromNode=function(e,t){return new o(e,t)},o.prototype={updateInstallationMRU:function(){this.$installationPane.updateInstallationMRU()}},u.prototype={getClient:function(){return this.$bar.$client},setToken:function(e){this.getClient().setToken(e),t.set("token",e),e===null?this.$mode==="keySecret"?(this.$keyNode.val(""),this.$secretNode.val("")):this.$userIdNode.val(""):e.userId?(this.$userIdNode.val(e.userId),this.$setMode("userId")):(this.$keyNode.val(e.key),this.$secretNode.val(e.secret),this.$setMode("keySecret"))},$setMode:function(e){if(this.$mode===e)return;this.$paneNode.find(a(this.$mode)).hide(),this.$paneNode.find(a(e)).show(),this.$mode=e},$keySecretChanged:function(){var e=this.$keyNode.val().trim(),n=this.$secretNode.val().trim(),r;this.$setMode("keySecret"),this.$keyNode.val(e),this.$secretNode.val(n);if(f(e)&&l(n))r={key:e,secret:n};else{if(!!e||!!n)return;r=null}this.getClient().setToken(r),t.set("token",r)},$userIdChanged:function(){var e=this.$userIdNode.val().trim(),n;this.$setMode("userId"),this.$userIdNode.val(e);if(c(e))n={userId:parseInt(e,10)};else{if(!!e)return;n=null}this.getClient().setToken(n),t.set("token",n)},acquireAccessToken:function(){var e=this;this.getClient().callMethod({path:"services/apiref/scopes",signMode:n.ANONYMOUS,success:function(n){var r=$(i("scope-dialog",{scopes:n.getJSON()})).dialog({modal:!0,width:800,buttons:{OK:function(){var n=[];r.serializeArray().forEach(function(e){e.name==="scopes[]"&&n.push(e.value)}),r.dialog("close").remove(),t.set("scopes",n),e.getClient().acquireAccessToken({scopes:n,success:function(t){e.setToken(t)},error:function(){s.showGenericClientError()}})}},close:function(){r.remove()}});t.get("scopes",[]).forEach(function(e){r.find('input[name="scopes[]"][value="'+e+'"]').prop("checked",!0)})},error:function(){s.showGenericClientError()}})}},h.prototype={getClient:function(){return this.$bar.$client},setConsumer:function(e){this.$keyNode.val(e&&e.key||""),this.$secretNode.val(e&&e.secret||""),this.getClient().setConsumer(e),t.set("consumer",e)},$changed:function(){var e=this.$keyNode.val().trim(),n=this.$secretNode.val().trim(),r;this.$keyNode.val(e),this.$secretNode.val(n);if(p(e)&&d(n))r={key:e,secret:n};else{if(!!e||!!n)return;r=null}this.getClient().setConsumer(r),t.set("consumer",r)}},$.widget("custom.installationAutocomplete",$.ui.autocomplete,{_renderItem:function(e,t){var n=$("<a/>").text(t.url).append("<br/>");return t.name&&n.append($("<small/>").text(t.name)),$("<li/>").append(n).appendTo(e)}}),v.prototype={getClient:function(){return this.$bar.$client},setInstallation:function(e){this.$baseURLNode.val(e&&e.baseURL||""),this.getClient().setBaseURL(e?e.baseURL:null),t.set("installation",e)},$getAutocompleteSource:function(){function i(e){var t=r.$installationNames[e];n.push({label:e,url:e,name:t})}var e={},n=[],r=this;return t.get("installationMRU",[]).forEach(function(t){e[t.baseURL]=!0,i(t.baseURL)}),this.$installationURLs.forEach(function(t){e[t]||i(t)}),n},$autocompleteSourceChanged:function(){this.$baseURLNode.installationAutocomplete("option","source",this.$getAutocompleteSource())},updateInstallationMRU:function(){var e=this.$baseURLNode.val().trim();m(e)&&(t.addMRU("installationMRU",{baseURL:e},10,function(e,t){return e.baseURL===t.baseURL}),this.$autocompleteSourceChanged())},$changed:function(){var e=this.$baseURLNode.val().trim(),n;this.$baseURLNode.val(e);if(m(e))n={baseURL:e};else{if(!!e)return;n=null}this.getClient().setBaseURL(n?n.baseURL:null),t.set("installation",n)}},{ClientBar:o}}),define("fiddler/util/apiref",[],function(){function e(e,t,n){function i(s){var o,u=[],a=[];while(r<e.length&&e[r].name.slice(0,s.length)===s)o=e[r].name.indexOf("/",s.length),o===-1?(u.push(n(s.slice(0,-1),e[r])),r++):a.push(i(e[r].name.slice(0,o+1)));return t(s.slice(0,-1),a,u)}var r=0;return e=e.slice(),e.sort(function(e,t){return e.name<t.name?-1:1}),i("services/")}return{reduceMethodIndex:e}}),define("fiddler/method-index-bar",["require","./util/apiref","./client","./dialog"],function(e){function s(e,t,n){this.$node=e,this.$filterNode=e.parent().find(".fiddler-method-search-form input"),this.$filterTimer=null,this.$client=t,this.$activate=n,this.$filterNode.keypress(this.$scheduleFilter.bind(this))}var t=e("./util/apiref").reduceMethodIndex,n=e("./client").SignMode,r=e("./dialog").Dialog,i=500;return s.createFromNode=function(e,t,n){return new s(e,t,n)},s.prototype={$scheduleFilter:function(){this.$filterTimer||(this.$filterTimer=setTimeout(this.$runFilter.bind(this),i))},$runFilter:function(){function t(t){return t.indexOf(e)!==-1}function n(e,r){return e.children("li").map(function(e,i){var s,o;return i=$(i),i.hasClass("fiddler-module")?(s=r+i.children(".fiddler-module-name").text()+"/",t(s)?(i.css({display:""}),i.find("li").css({display:""}),!0):(o=n(i.children("ul"),s),o?(i.css({display:""}),!0):(i.css({display:"none"}),!1))):t(r+i.text())?(i.css({display:""}),!0):(i.css({display:"none"}),!1)}).get().reduce(function(e,t){return e||t},!1)}clearTimeout(this.$filterTimer),this.$filterTimer=null;var e=this.$filterNode.val();n(this.$node.children("ul"),"services/")},refresh:function(){var e=this;this.$client.callMethod({path:"services/apiref/method_index",signMode:n.ANONYMOUS,success:function(n){var r;r=t(n.getJSON(),function(e,t,n){var r=$("<ul/>").append(t).append(n);return e==="services"?r:$("<li class='fiddler-module'/>").append($("<span class='fiddler-module-name'/>").text(e.slice(e.lastIndexOf("/")+1)).click(function(){$(this).parent().toggleClass("fiddler-collapsed").children("ul").toggle(200)})).append(r)},function(t,n){var r=n.name.slice(t.length+1);return $("<li class='fiddler-method'/>").append($('<a href="#"/>').text(r).click(function(t){t.preventDefault(),e.$activate(n.name)}).attr("title",n.brief_description))}),e.$node.empty().append(r).tooltip({show:!1,hide:!1}),e.$runFilter()},error:function(){r.showGenericClientError()}})}},{MethodIndexBar:s}}),require(["require","fiddler/client","fiddler/method-tab","fiddler/tab","fiddler/dialog","fiddler/client-bar","fiddler/method-index-bar"],function(e){function h(){$("body").layout({maskIframesOnResize:!0,fxName:"none",north:{resizable:!1,closable:!1,size:90,spacing_open:0},west:{size:300,contentSelector:".fiddler-content"},center:{contentSelector:".fiddler-content",onresize_end:function(){f.resize()}}})}function p(e){a.callMethod({path:"services/apiref/method",signMode:n.ANONYMOUS,params:{name:e},success:function(e){var t=f.getActiveTab();if(t===null||t.isPinned())t=new s(a),f.addTab(t),t.activate();t.setMethodInfo(e.getJSON())},error:function(){r.showGenericClientError()}})}var t=e("fiddler/client").Client,n=e("fiddler/client").SignMode,r=e("fiddler/dialog").Dialog,i=e("fiddler/tab").Tabs,s=e("fiddler/method-tab").MethodTab,o=e("fiddler/client-bar").ClientBar,u=e("fiddler/method-index-bar").MethodIndexBar,a,f=null,l=null,c=null;$(function(){h(),a=new t,f=i.createFromNode($(".fiddler-tabbar").parent()),l=o.createFromNode($(".fiddler-clientbar"),a),c=u.createFromNode($(".fiddler-method-index"),a,p),$("#installation-change").click(function(){l.updateInstallationMRU(),c.refresh()})})}),define("fiddler",function(){});